---
outline: deep
---

# Управление эндпоинтами

Справочник `инт_Эндпоинты` хранит настройки подключения ко внешним системам: URL, тип авторизации и учётные данные. Все подписчики ссылаются на эндпоинт — это позволяет переключать среды (dev/test/prod) одним изменением без правки каждого подписчика.

## Структура эндпоинта

| Реквизит | Тип | Описание |
|----------|-----|----------|
| `Наименование` | Строка(150) | Понятное имя (например, «WMS Production») |
| `АдресРесурса` | Строка(500) | Базовый URL (`https://api.example.com`) |
| `ТипАвторизации` | `инт_ТипыАвторизации` | Способ авторизации |
| `ПроверятьSSL` | Булево | Проверять TLS-сертификат сервера (по умолчанию `Истина`) |
| `ТаймаутСоединения` | Число | Таймаут подключения в секундах |

Секретные данные (пароли, токены, ключи) **не хранятся в реквизитах справочника** — они записываются в `БезопасноеХранилище` при сохранении формы и читаются оттуда при отправке запросов.

## Типы авторизации

### Анонимный

Без авторизации. Используется для публичных API или внутренних сервисов в доверенной сети.

### Basic

HTTP Basic Authentication — имя пользователя и пароль передаются в заголовке `Authorization: Basic <base64>`.

| Параметр | Описание |
|----------|----------|
| Пользователь | Логин |
| Пароль | Пароль (хранится в БезопасноеХранилище) |

### Bearer

Bearer Token — токен передаётся в заголовке `Authorization: Bearer <token>`.

| Параметр | Описание |
|----------|----------|
| Токен | Access token или API key (хранится в БезопасноеХранилище) |

### Digest

HTTP Digest Authentication — более безопасный вариант Basic Auth с challenge-response механизмом.

| Параметр | Описание |
|----------|----------|
| Пользователь | Логин |
| Пароль | Пароль (хранится в БезопасноеХранилище) |

### TLS (mTLS)

Клиентский TLS-сертификат для двусторонней аутентификации (Mutual TLS).

| Параметр | Описание |
|----------|----------|
| Источник сертификата | Файл `.pfx`/`.p12` или хранилище Windows |
| Путь к файлу | Полный путь к файлу сертификата |
| Пароль сертификата | Пароль защиты файла (хранится в БезопасноеХранилище) |
| Отпечаток (хранилище) | Fingerprint сертификата в хранилище Windows |

### ApiKey

API Key в произвольном HTTP-заголовке.

| Параметр | Описание |
|----------|----------|
| Имя заголовка | Например, `X-API-Key` или `X-Auth-Token` |
| Значение ключа | Сам ключ (хранится в БезопасноеХранилище) |

## Хранение секретных данных

Все чувствительные данные хранятся в регистре `инт_БезопасноеХранилищеДанных` (обёртка над стандартным `БезопасноеХранилище`). Ключи хранения зависят от типа авторизации:

| Ключ | Тип авторизации | Содержимое |
|------|-----------------|------------|
| `Basic_Пользователь` | Basic, Digest | Имя пользователя |
| `Basic_Пароль` | Basic, Digest | Пароль |
| `Bearer_Токен` | Bearer | Токен |
| `Tls_СертификатПуть` | Tls | Путь к файлу сертификата |
| `Tls_СертификатПароль` | Tls | Пароль сертификата |
| `Tls_СертификатХранилище` | Tls | Отпечаток сертификата Windows |
| `ApiKey_ИмяЗаголовка` | ApiKey | Имя заголовка |
| `ApiKey_Значение` | ApiKey | Значение ключа |

::: warning Права доступа
Запись в безопасное хранилище требует права администратора или наличия роли `инт_АдминистраторПодсистемы`. Убедитесь, что регламентные задания также имеют право на чтение.
:::

## Проверка подключения

Форма элемента эндпоинта содержит кнопку **«Проверить подключение»**, которая выполняет тестовый HTTP-запрос (для Kafka — проверку доступности брокера) и отображает результат. Это позволяет убедиться в корректности настроек до запуска потоков.

```bsl
// Программная проверка подключения
Результат = инт_КоннекторHTTP.ПроверитьПодключение(Эндпоинт);
Если Результат.Успех Тогда
    Сообщить("Подключение успешно: " + Результат.КодСостояния);
Иначе
    Сообщить("Ошибка: " + Результат.ОписаниеОшибки);
КонецЕсли;
```

## Несколько сред (dev/test/prod)

Рекомендуемый подход: создайте три эндпоинта с одинаковыми именами с суффиксами, например:

```
WMS API (Dev)    → https://wms-dev.internal/api
WMS API (Test)   → https://wms-test.internal/api
WMS API (Prod)   → https://wms.example.com/api
```

Подписчик в потоке данных ссылается на один эндпоинт. При переключении среды достаточно поменять ссылку в подписчике — без изменения авторизационных данных. Все три эндпоинта хранят свои собственные учётные данные.

## Следующие шаги

- [Настройка подписчиков](/guide/configure-subscribers) — привязка эндпоинтов к типам подписчиков
- [Настройка эндпоинтов (практика)](/guide/configure-endpoints) — пошаговое руководство
- [Подписчики](/concepts/subscribers) — типы подписчиков и их параметры
