---
outline: deep
---

# Подписчики

**Подписчик** — это внешняя система или сервис, получающий сообщения из исходящего потока данных.

## Типы подписчиков

Подсистема поддерживает несколько типов подписчиков, реализованных как отдельные справочники:

| Тип | Справочник | Протокол |
|-----|------------|----------|
| HTTP произвольный | `инт_ПодписчикиHTTP` | HTTP/HTTPS REST |
| Подсистема интеграции | `инт_ПодписчикиПодсистемаИнтеграции` | HTTP (специальный формат) |
| RabbitMQ | `инт_ПодписчикиRabbitMQ` | AMQP |
| Kafka | `инт_ПодписчикиKafka` | Kafka Protocol |
| JRPC 2.0 | `инт_ПодписчикиJRPC` | JSON-RPC 2.0 over HTTP |

## Базовый справочник подписчиков

Все типы подписчиков наследуются от базового справочника `инт_Подписчики`:

| Реквизит | Тип | Описание |
|----------|-----|----------|
| `Наименование` | Строка | Название подписчика |
| `Активен` | Булево | Включён ли подписчик |
| `ТипПодписчика` | Перечисление.инт_ТипыПодписчиков | Тип подписчика |
| `ПаузаМеждуПопыткамиОтправки` | Число | Интервал повтора (сек) |
| `КоличествоПопыток` | Число | Максимум попыток отправки |

## HTTP-подписчик

Отправка сообщений на произвольный REST API endpoint.

### Настройки

| Реквизит | Описание |
|----------|----------|
| `Эндпоинт` | Ссылка на `инт_Эндпоинты` с настройками подключения |
| `Путь` | URI path для запроса (например, `/api/v1/orders`) |
| `МетодHTTP` | HTTP-метод (POST, PUT, PATCH) |
| `ТипАвторизации` | Basic, Bearer, OAuth2, или без авторизации |
| `Сериализация` | Формат сериализации (JSON, XML) |
| `ОбработчикОтвета` | BSL-код для обработки ответа |

### Пример настройки

```
┌─────────────────────────────────────────────────────────────────┐
│  Подписчик HTTP: "Отправка заказов в WMS"                       │
├─────────────────────────────────────────────────────────────────┤
│  Эндпоинт:        WMS Production (https://wms.example.com)      │
│  Путь:            /api/v1/orders                                │
│  Метод HTTP:      POST                                          │
│  Тип авторизации: Bearer Token                                  │
│  Сериализация:    JSON                                          │
└─────────────────────────────────────────────────────────────────┘
```

### Обработчик ответа

После отправки сообщения можно выполнить произвольный код для обработки ответа:

```bsl
// Доступные переменные:
// - ОтветHTTP - Структура с полями: КодСостояния, Тело, Заголовки
// - ИсходныеДанные - Ссылка на исходный объект

Если ОтветHTTP.КодСостояния = 200 Тогда
    ТелоОтвета = ОтветHTTP.Тело;
    // Парсинг JSON-ответа
    ЧтениеJSON = Новый ЧтениеJSON;
    ЧтениеJSON.УстановитьСтроку(ТелоОтвета);
    ДанныеОтвета = ПрочитатьJSON(ЧтениеJSON);
    
    // Сохранение внешнего ID
    ВнешнийID = ДанныеОтвета.Получить("externalId");
    РегистрыСведений.инт_ИдентификаторыВнешнихСистем.Записать(
        ИсходныеДанные,
        "WMS",
        ВнешнийID
    );
КонецЕсли;
```

## RabbitMQ-подписчик

Публикация сообщений в очередь RabbitMQ.

### Настройки

| Реквизит | Описание |
|----------|----------|
| `Эндпоинт` | Подключение к RabbitMQ |
| `Exchange` | Имя exchange |
| `RoutingKey` | Ключ маршрутизации |
| `Durable` | Сохранять ли сообщения на диск |

### Схема работы

```
┌─────────────┐      ┌────────────────┐      ┌─────────────┐
│  1C         │      │   RabbitMQ     │      │  Consumer   │
│  Publisher  │─────▶│   Exchange     │─────▶│  Service    │
│             │      │   + Queue      │      │             │
└─────────────┘      └────────────────┘      └─────────────┘
```

## Kafka-подписчик

Публикация сообщений в топик Apache Kafka.

### Настройки

| Реквизит | Описание |
|----------|----------|
| `Топик` | Ссылка на `инт_ТопикиKafka` |
| `Партиция` | Номер партиции (или авто) |
| `Ключ` | Шаблон ключа сообщения |

### Схема работы

```
┌─────────────┐      ┌────────────────┐      ┌─────────────┐
│  1C         │      │   Kafka        │      │  Consumer   │
│  Producer   │─────▶│   Topic        │─────▶│  Group      │
│             │      │   (partition)  │      │             │
└─────────────┘      └────────────────┘      └─────────────┘
```

## Подсистема интеграции

Межбазовая интеграция с другой инсталляцией подсистемы.

### Назначение

- Обмен данными между базами 1С
- Использование единого формата сообщений
- Автоматическая десериализация на стороне получателя

### Схема работы

```
┌──────────────────────┐        ┌──────────────────────┐
│  База 1С #1          │        │  База 1С #2          │
│  (Подсистема инт.)   │───────▶│  (Подсистема инт.)   │
│  Исходящий поток     │  HTTP  │  Входящий поток      │
└──────────────────────┘        └──────────────────────┘
```

## JRPC 2.0-подписчик

Отправка JSON-RPC 2.0 запросов.

### Настройки

| Реквизит | Описание |
|----------|----------|
| `Эндпоинт` | URL JSON-RPC сервера |
| `Метод` | Имя RPC-метода |
| `ВключатьID` | Генерировать уникальный ID запроса |

### Формат сообщения

```json
{
  "jsonrpc": "2.0",
  "method": "createOrder",
  "params": {
    "orderNumber": "00001",
    "date": "2026-01-27",
    "items": [...]
  },
  "id": "550e8400-e29b-41d4-a716-446655440000"
}
```

## Привязка подписчиков к потоку

Подписчики добавляются в табличную часть `ПодписчикиПотока` справочника `инт_ПотокиДанных`:

```bsl
// Программное добавление подписчика к потоку
ПотокОбъект = ПотокДанных.ПолучитьОбъект();
НоваяСтрока = ПотокОбъект.ПодписчикиПотока.Добавить();
НоваяСтрока.Подписчик = Справочники.инт_ПодписчикиHTTP.НайтиПоНаименованию("WMS API");
ПотокОбъект.Записать();
```

## Получение подписчиков потока

```bsl
МассивПодписчиков = Справочники.инт_ПотокиДанных.ПолучитьПодписчиковПоПотоку(ПотокДанных);
// Возвращает: Массив ссылок на подписчиков
```

## Статусы рассылки

Для каждой пары "сообщение + подписчик" ведётся отдельный статус в регистре `инт_ТекущийСтатусРассылкиСообщений`:

| Статус | Описание |
|--------|----------|
| `Новый` | Ожидает отправки |
| `ВПроцессеОтправки` | Отправляется фоновым заданием |
| `Отправлено` | Успешно доставлено |
| `ОшибкаОтправки` | Ошибка, будет повторная попытка |

## Рекомендации

::: tip Разделение эндпоинтов
Выносите настройки подключения (URL, порт, учётные данные) в справочник `инт_Эндпоинты`. Это упрощает переключение между средами (dev/test/prod).
:::

::: tip Обработка ответов
Используйте обработчик ответов для:
- Сохранения внешних идентификаторов
- Логирования результатов
- Обновления статусов в связанных объектах
:::

::: warning Таймауты
Настраивайте разумные таймауты подключения в эндпоинтах. Слишком большие таймауты могут блокировать фоновые задания.
:::

## Следующие шаги

- [Валидация](/concepts/validation) — проверка сообщений перед отправкой
- [Очереди сообщений](/concepts/message-queues) — как работают очереди
- [Настройка подписчиков (практика)](/guide/configure-subscribers)
