// BSLLS-off
// @strict-types
////////////////////////////////////////////////////////////////////////////////
// СПР_инт_Эндпоинты_ММ
// Юнит-тесты для модуля менеджера справочника инт_Эндпоинты
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныйПрограммныйИнтерфейс

Процедура ИсполняемыеСценарии() Экспорт
	
	ЮТТесты.УдалениеТестовыхДанных()
		.ВТранзакции()
		.ДобавитьТестовыйНабор("ПолучитьАутентификацию")
			.ДобавитьТест("ТестПолучитьАутентификациюBasic")
			.ДобавитьТест("ТестПолучитьАутентификациюDigest")
			.ДобавитьТест("ТестПолучитьАутентификациюBearer")
			.ДобавитьТест("ТестПолучитьАутентификациюApiKey")
			.ДобавитьТест("ТестПолучитьАутентификациюАнонимный")
		.ДобавитьТестовыйНабор("СтруктураПараметровСоединения")
			.ДобавитьТест("ТестСтруктураПараметровСоединения")
			.ДобавитьТест("ТестСтруктураПараметровСоединенияПоУмолчанию");
			
КонецПроцедуры

#КонецОбласти

#Область Тесты

// Тест: Получить аутентификацию Basic возвращает структуру с типом Basic
Процедура ТестПолучитьАутентификациюBasic() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.ЭндпоинтBasic("testuser", "testpass");
	
	// Act
	Аутентификация = Справочники.инт_Эндпоинты.ПолучитьАутентификацию(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(Аутентификация)
		.ИмеетТип("Структура")
		.ИмеетСвойство("Тип").Равно("Basic")
		.ИмеетСвойство("Пользователь").Равно("testuser")
		.ИмеетСвойство("Пароль").Равно("testpass");
	
КонецПроцедуры

// Тест: Получить аутентификацию Digest возвращает структуру с типом Digest
Процедура ТестПолучитьАутентификациюDigest() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.Эндпоинт("Digest");
	
	// Act
	Аутентификация = Справочники.инт_Эндпоинты.ПолучитьАутентификацию(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(Аутентификация)
		.ИмеетТип("Структура")
		.ИмеетСвойство("Тип").Равно("Digest")
		.ИмеетСвойство("Пользователь")
		.ИмеетСвойство("Пароль");
	
КонецПроцедуры

// Тест: Получить аутентификацию Bearer возвращает структуру с типом Bearer
Процедура ТестПолучитьАутентификациюBearer() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.ЭндпоинтBearer("test_token_12345");
	
	// Act
	Аутентификация = Справочники.инт_Эндпоинты.ПолучитьАутентификацию(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(Аутентификация)
		.ИмеетТип("Структура")
		.ИмеетСвойство("Тип").Равно("Bearer")
		.ИмеетСвойство("Токен").Равно("test_token_12345");
	
КонецПроцедуры

// Тест: Получить аутентификацию ApiKey возвращает структуру с типом ApiKey
Процедура ТестПолучитьАутентификациюApiKey() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.ЭндпоинтApiKey("X-API-Key", "my_secret_key");
	
	// Act
	Аутентификация = Справочники.инт_Эндпоинты.ПолучитьАутентификацию(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(Аутентификация)
		.ИмеетТип("Структура")
		.ИмеетСвойство("Тип").Равно("ApiKey")
		.ИмеетСвойство("ИмяЗаголовка").Равно("X-API-Key")
		.ИмеетСвойство("Значение").Равно("my_secret_key");
	
КонецПроцедуры

// Тест: Получить аутентификацию для анонимного типа возвращает Неопределено
Процедура ТестПолучитьАутентификациюАнонимный() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.Эндпоинт("Анонимный");
	
	// Act
	Аутентификация = Справочники.инт_Эндпоинты.ПолучитьАутентификацию(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(Аутентификация)
		.Равно(Неопределено);
	
КонецПроцедуры

// Тест: Структура параметров соединения содержит все необходимые поля
Процедура ТестСтруктураПараметровСоединения() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.ЭндпоинтBasic("user", "pass", "https://api.example.com");
	
	// Act
	ПараметрыСоединения = Справочники.инт_Эндпоинты.СтруктураПараметровСоединения(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(ПараметрыСоединения)
		.ИмеетТип("Структура")
		.ИмеетСвойство("АдресРесурса").Равно("https://api.example.com")
		.ИмеетСвойство("Сессия").ИмеетТип("Структура")
		.ИмеетСвойство("ПроверятьSSL").ИмеетТип("Булево")
		.ИмеетСвойство("Таймаут").ИмеетТип("Число");
	
	// Проверяем, что сессия содержит аутентификацию
	ЮТест.ОжидаетЧто(ПараметрыСоединения.Сессия)
		.ИмеетСвойство("Аутентификация");
	
КонецПроцедуры

// Тест: Таймаут по умолчанию равен 30, если не задан
Процедура ТестСтруктураПараметровСоединенияПоУмолчанию() Экспорт
	
	// Arrange
	Эндпоинт = ГенераторТестовыхДанных.Эндпоинт("Анонимный", "https://test.example.com", Истина, 0);
	
	// Act
	ПараметрыСоединения = Справочники.инт_Эндпоинты.СтруктураПараметровСоединения(Эндпоинт);
	
	// Assert
	ЮТест.ОжидаетЧто(ПараметрыСоединения.Таймаут)
		.Равно(30);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#КонецОбласти

