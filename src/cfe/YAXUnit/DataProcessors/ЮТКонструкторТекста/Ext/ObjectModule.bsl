//©///////////////////////////////////////////////////////////////////////////©//
//
//  Copyright 2021-2025 BIA-Technologies Limited Liability Company
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//
//©///////////////////////////////////////////////////////////////////////////©//

#Если Сервер Или ТолстыйКлиентОбычноеПриложение Тогда

#Область ОписаниеПеременных

Перем Контекст;

#КонецОбласти

#Область ПрограммныйИнтерфейс

// Добавляет новую строку в конец коллекции строк с учетом текущего отступа.
//
// Параметры:
//   Текст - Строка - основное содержимое строки.
//   НачалоСтроки - Строка - префикс, добавляемый перед текстом (по умолчанию пустая строка).
//   КонецСтроки - Строка - суффикс, добавляемый после текста (по умолчанию пустая строка).
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Привет", "[", "]")
//       .Текст();
//   // Результат: "[Привет]" с учетом текущего отступа
//
Функция НоваяСтрока(Текст = "", НачалоСтроки = "", КонецСтроки = "") Экспорт
	
	ПодготовленныйТекст = НачалоСтроки + Текст + КонецСтроки;
	
	Контекст.Строки.Добавить(Контекст.ТекущийОтступ + ПодготовленныйТекст);
	
	Возврат ЭтотОбъект;
	
КонецФункции

// Формирует строку по шаблону с подстановкой параметров и добавляет ее в коллекцию.
// Автоматически экранирует кавычки в параметрах.
//
// Параметры:
//   Шаблон - Строка - строка с плейсхолдерами (%1, %2, ..., %9) для подстановки параметров.
//   П1 - Произвольный - первый параметр для подстановки (по умолчанию пустая строка).
//   П2 - Произвольный - второй параметр для подстановки (по умолчанию пустая строка).
//   П3 - Произвольный - третий параметр для подстановки (по умолчанию пустая строка).
//   П4 - Произвольный - четвертый параметр для подстановки (по умолчанию пустая строка).
//   П5 - Произвольный - пятый параметр для подстановки (по умолчанию пустая строка).
//   П6 - Произвольный - шестой параметр для подстановки (по умолчанию пустая строка).
//   П7 - Произвольный - седьмой параметр для подстановки (по умолчанию пустая строка).
//   П8 - Произвольный - восьмой параметр для подстановки (по умолчанию пустая строка).
//   П9 - Произвольный - девятый параметр для подстановки (по умолчанию пустая строка).
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрокаПоШаблону("Сообщение: %1, код: %2", "Ошибка", 404)
//       .Текст();
//   // Результат: "Сообщение: ""Ошибка"", код: ""404""" с учетом текущего отступа
//
Функция НоваяСтрокаПоШаблону(Шаблон, П1 = "", П2 = "", П3 = "", П4 = "", П5 = "", П6 = "", П7 = "", П8 = "", П9 = "") Экспорт
	
	ПодготовленныйТекст = СтрШаблон(Шаблон +  "%10", П1, П2, П3, П4, П5, П6,  П7, П8, П9, "");
	НоваяСтрока(ПодготовленныйТекст);
	
	Возврат ЭтотОбъект;
	
КонецФункции

// Добавляет текст, разбивая его на строки по разделителю, с применением отступа к каждой строке.
//
// Параметры:
//   Текст - Строка - текст для добавления, который будет разбит на строки.
//   РазмерСдвига - Число - количество символов отступа для каждой строки (по умолчанию 0).
//   РазделительСтрок - Строка, Неопределено - разделитель для разбиения текста на строки.
//                     Если Неопределено, используется символ перевода строки (Символы.ПС).
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("// Первая строка")
//       .ДобавитьТекст("Строка1|Строка2", 1, "|")
//       .Текст();
//   // Результат: "// Первая строка" + Символы.ПС + Символы.Таб + "Строка1" + Символы.ПС + Символы.Таб + "Строка2"
//
Функция ДобавитьТекст(Текст, РазмерСдвига = 0, РазделительСтрок = Неопределено) Экспорт
	
	ДобавляемыеСтроки = СтрРазделить(Текст, ?(РазделительСтрок = Неопределено, Символы.ПС, РазделительСтрок));
	
	Для Каждого Стр Из ДобавляемыеСтроки Цикл
		НоваяСтрока(Стр).Табуляция(РазмерСдвига);
	КонецЦикла;
	
	Возврат ЭтотОбъект;
	
КонецФункции
	
// Вставляет строку в указанную позицию коллекции без применения текущего отступа.
//
// Параметры:
//   Позиция - Число - индекс позиции для вставки (начиная с 0).
//   Текст - Строка - основное содержимое строки.
//   НачалоСтроки - Строка - префикс, добавляемый перед текстом (по умолчанию пустая строка).
//   КонецСтроки - Строка - суффикс, добавляемый после текста (по умолчанию пустая строка).
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .НоваяСтрока("Строка2")
//       .ВставитьСтроку(1, "Строка", "0", "3")
//       .Текст();
//   // Результат: "Строка1" + Символы.ПС + "0Строка3" + Символы.ПС + "Строка2"
//
Функция ВставитьСтроку(Позиция, Текст, НачалоСтроки = "", КонецСтроки = "") Экспорт
	
	ПодготовленныйТекст = НачалоСтроки + Текст + КонецСтроки;
	
	Контекст.Строки.Вставить(Позиция, ПодготовленныйТекст);
	
	Возврат ЭтотОбъект;
	
КонецФункции

// Вставляет строку в начало коллекции (позиция 0) без применения текущего отступа.
//
// Параметры:
//   Текст - Строка - основное содержимое строки.
//   НачалоСтроки - Строка - префикс, добавляемый перед текстом (по умолчанию пустая строка).
//   КонецСтроки - Строка - суффикс, добавляемый после текста (по умолчанию пустая строка).
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .НоваяСтрока("Строка2")
//       .ВставитьПервуюСтроку("Строка", "0", "3")
//       .Текст();
//   // Результат: "0Строка3" + Символы.ПС + "Строка1" + Символы.ПС + "Строка2"
//
Функция ВставитьПервуюСтроку(Текст, НачалоСтроки = "", КонецСтроки = "") Экспорт

	Возврат ВставитьСтроку(0, Текст, НачалоСтроки, КонецСтроки);
	
КонецФункции
	
// Добавляет символ перевода строки (Символы.ПС) в конец последней строки коллекции.
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .ПереносСтроки()
//       .Текст();
//   // Результат: "Строка1" + символ перевода строки
//
Функция ПереносСтроки() Экспорт

	Возврат ДобавитьВКонецСтроки(Символы.ПС);
	
КонецФункции

#Область Отступ

// Увеличивает размер текущего отступа на единицу.
// Все последующие строки, добавляемые через НоваяСтрока, будут иметь увеличенный отступ.
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .УвеличитьОтступ()
//       .НоваяСтрока("Строка2")
//       .Текст();
//   // Результат: "Строка2" будет иметь отступ на один символ больше, чем "Строка1"
//
Функция УвеличитьОтступ() Экспорт
	
	Контекст.РазмерОтступа = Контекст.РазмерОтступа + 1;
	Контекст.ТекущийОтступ = ЮТСтроки.СтрокаСимволов(Контекст.СимволОтступа, Контекст.РазмерОтступа);
	
	Возврат ЭтотОбъект;
	
КонецФункции

// Уменьшает размер текущего отступа на единицу.
// Все последующие строки, добавляемые через НоваяСтрока, будут иметь уменьшенный отступ.
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .УвеличитьОтступ()
//       .НоваяСтрока("Строка1")
//       .УменьшитьОтступ()
//       .НоваяСтрока("Строка2")
//       .Текст();
//   // Результат: "Строка2" будет иметь отступ на один символ меньше, чем "Строка1"
//
Функция УменьшитьОтступ() Экспорт
	
	Контекст.РазмерОтступа = Контекст.РазмерОтступа - 1;
	Контекст.ТекущийОтступ = ЮТСтроки.СтрокаСимволов(Контекст.СимволОтступа, Контекст.РазмерОтступа);
	
	Возврат ЭтотОбъект;
	
КонецФункции

// Добавляет символы табуляции в начало последней строки коллекции.
//
// Параметры:
//   Количество - Число - количество символов табуляции для добавления (по умолчанию 1).
//                Если значение меньше или равно 0, табуляция не добавляется.
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Текст")
//       .Табуляция(2)
//       .Текст();
//   // Результат: два символа табуляции + "Текст"
//
Функция Табуляция(Количество = 1) Экспорт
	
	Если Количество > 0 Тогда
		Табы = ЮТСтроки.СтрокаСимволов(Контекст.СимволОтступа, Количество);
		
		ПоследнийЭлемент = Контекст.Строки.Количество() - 1;
		Контекст.Строки[ПоследнийЭлемент] = Табы + Контекст.Строки[ПоследнийЭлемент];
	КонецЕсли;
	
	Возврат ЭтотОбъект;
	
КонецФункции

#КонецОбласти

// Добавляет суффикс в конец последней строки коллекции.
//
// Параметры:
//   Суффикс - Строка - текст, добавляемый в конец последней строки.
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Текст")
//       .ДобавитьВКонецСтроки(";")
//       .Текст();
//   // Результат: "Текст;"
//
Функция ДобавитьВКонецСтроки(Суффикс) Экспорт
	
	ПоследнийЭлемент = Контекст.Строки.Количество() - 1;
	Контекст.Строки[ПоследнийЭлемент] = Контекст.Строки[ПоследнийЭлемент] + Суффикс;
	
	Возврат ЭтотОбъект;
КонецФункции

// Устанавливает разделитель для объединения строк при получении итогового текста.
// По умолчанию используется символ перевода строки (Символы.ПС).
//
// Параметры:
//   Разделитель - Строка - разделитель, используемый при объединении строк методом Текст().
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .НоваяСтрока("Строка2")
//       .Разделитель(", ")
//       .Текст();
//   // Результат: "Строка1, Строка2"
//
Функция Разделитель(Разделитель) Экспорт
	
	Контекст.Разделитель = Разделитель;
	
	Возврат ЭтотОбъект;
	
КонецФункции

// Возвращает объединенный текст всех строк коллекции с использованием установленного разделителя.
//
// Возвращаемое значение:
//   Строка - объединенный текст всех строк коллекции.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .НоваяСтрока("Строка2")
//       .Текст();
//   // Результат: "Строка1" + Символы.ПС + "Строка2"
//
Функция Текст() Экспорт
	
	Возврат СтрСоединить(Контекст.Строки, Контекст.Разделитель);
	
КонецФункции

// Возвращает количество строк в коллекции.
//
// Возвращаемое значение:
//   Число - количество строк в коллекции.
//
// Пример:
//   Количество = ЮТРаботаСТекстом.КонструкторТекста()
//       .НоваяСтрока("Строка1")
//       .НоваяСтрока("Строка2")
//       .КоличествоСтрок();
//   // Результат: 2
//
Функция КоличествоСтрок() Экспорт
	
	Возврат Контекст.Строки.Количество();
	
КонецФункции

// Заменяет текущие строки коллекции на строки, полученные из переданного текста.
// Текст разбивается на строки с использованием текущего разделителя.
//
// Параметры:
//   Текст - Строка - текст для разбиения на строки и установки в коллекцию.
//
// Возвращаемое значение:
//   ОбработкаОбъект.ЮТКонструкторТекста - текущий объект для поддержки цепочки вызовов.
//
// Пример:
//   Результат = ЮТРаботаСТекстом.КонструкторТекста()
//       .УстановитьТекст("Строка1" + Символы.ПС + "Строка2")
//       .Текст();
//   // Результат: коллекция будет содержать две строки "Строка1" и "Строка2"
//
Функция УстановитьТекст(Текст) Экспорт
	
	СтрокиТекста = СтрРазделить(Текст, Контекст.Разделитель);
	
	Для Каждого Стр Из СтрокиТекста Цикл
		НоваяСтрока(Стр);
	КонецЦикла;
	
	Возврат ЭтотОбъект;
		
КонецФункции

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// Инициализирует контекст конструктора текста.
// Должна быть вызвана перед использованием всех остальных методов.
// Создает пустую коллекцию строк, устанавливает разделитель по умолчанию (Символы.ПС)
// и символ отступа (Символы.Таб).
//
// Пример:
//   Конструктор = ЮТРаботаСТекстом.КонструкторТекста();
//   Конструктор.Инициализировать();
//
Процедура Инициализировать() Экспорт
	
	Контекст = Новый Структура;
	Контекст.Вставить("Строки", Новый Массив);
	Контекст.Вставить("Разделитель", Символы.ПС);
	Контекст.Вставить("СимволОтступа", Символы.Таб);
	Контекст.Вставить("РазмерОтступа", 0);
	Контекст.Вставить("ТекущийОтступ", "");
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли
