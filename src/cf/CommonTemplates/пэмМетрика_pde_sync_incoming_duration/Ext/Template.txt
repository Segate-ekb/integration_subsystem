// Метрика: Время синхронной обработки входящих сообщений (секунд)
// Лейблы: flow_name, aggregation (avg/max), status (success/error)
// Источник: РегистрСведений.инт_СтатистикаОбработкиСообщений
// Фильтр: только потоки с АсинхроннаяОбработка = Ложь

ТаблицаЗначений = Новый ТаблицаЗначений;
ТаблицаЗначений.Колонки.Добавить("flow_name", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("aggregation", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("status", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("value", Новый ОписаниеТипов("Число"));

Запрос = Новый Запрос;
Запрос.Текст =
"ВЫБРАТЬ
|	Статистика.ПотокДанных.Наименование КАК flow_name,
|	""avg"" КАК aggregation,
|	ВЫБОР
|		КОГДА Статистика.Успешно
|			ТОГДА ""success""
|		ИНАЧЕ ""error""
|	КОНЕЦ КАК status,
|	СРЕДНЕЕ(Статистика.ДлительностьМс) / 1000 КАК value
|ИЗ
|	РегистрСведений.инт_СтатистикаОбработкиСообщений КАК Статистика
|ГДЕ
|	Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.ОбработкаВходящего)
|	И Статистика.ПотокДанных.АсинхроннаяОбработка = ЛОЖЬ
|	И Статистика.Период >= &НачалоПериода
|СГРУППИРОВАТЬ ПО
|	Статистика.ПотокДанных.Наименование,
|	ВЫБОР
|		КОГДА Статистика.Успешно
|			ТОГДА ""success""
|		ИНАЧЕ ""error""
|	КОНЕЦ
|
|ОБЪЕДИНИТЬ ВСЕ
|
|ВЫБРАТЬ
|	Статистика.ПотокДанных.Наименование,
|	""max"",
|	ВЫБОР
|		КОГДА Статистика.Успешно
|			ТОГДА ""success""
|		ИНАЧЕ ""error""
|	КОНЕЦ,
|	МАКСИМУМ(Статистика.ДлительностьМс) / 1000
|ИЗ
|	РегистрСведений.инт_СтатистикаОбработкиСообщений КАК Статистика
|ГДЕ
|	Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.ОбработкаВходящего)
|	И Статистика.ПотокДанных.АсинхроннаяОбработка = ЛОЖЬ
|	И Статистика.Период >= &НачалоПериода
|СГРУППИРОВАТЬ ПО
|	Статистика.ПотокДанных.Наименование,
|	ВЫБОР
|		КОГДА Статистика.Успешно
|			ТОГДА ""success""
|		ИНАЧЕ ""error""
|	КОНЕЦ";

Запрос.УстановитьПараметр("НачалоПериода", ТекущаяДатаСеанса() - 300); // Последние 5 минут

Результат = Запрос.Выполнить();
Если НЕ Результат.Пустой() Тогда
	ТаблицаЗначений = Результат.Выгрузить();
КонецЕсли;
