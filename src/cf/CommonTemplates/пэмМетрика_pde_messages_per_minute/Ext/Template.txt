// Метрика: Обработано сообщений в минуту
// Лейблы: flow_name, operation, status (success/error)
// Источник: РегистрСведений.инт_СтатистикаОбработкиСообщений

ТаблицаЗначений = Новый ТаблицаЗначений;
ТаблицаЗначений.Колонки.Добавить("flow_name", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("operation", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("status", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("value", Новый ОписаниеТипов("Число"));

Запрос = Новый Запрос;
Запрос.Текст =
"ВЫБРАТЬ
|	ЕСТЬNULL(Статистика.ПотокДанных.Наименование, ""unknown"") КАК flow_name,
|	ВЫБОР
|		КОГДА Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.Формирование)
|			ТОГДА ""formation""
|		КОГДА Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.Отправка)
|			ТОГДА ""send""
|		КОГДА Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.ОбработкаВходящего)
|			ТОГДА ""incoming""
|		ИНАЧЕ ""unknown""
|	КОНЕЦ КАК operation,
|	ВЫБОР
|		КОГДА Статистика.Успешно
|			ТОГДА ""success""
|		ИНАЧЕ ""error""
|	КОНЕЦ КАК status,
|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ Статистика.ИдентификаторСообщения) КАК value
|ИЗ
|	РегистрСведений.инт_СтатистикаОбработкиСообщений КАК Статистика
|ГДЕ
|	Статистика.Период >= &НачалоПериода
|СГРУППИРОВАТЬ ПО
|	ЕСТЬNULL(Статистика.ПотокДанных.Наименование, ""unknown""),
|	ВЫБОР
|		КОГДА Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.Формирование)
|			ТОГДА ""formation""
|		КОГДА Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.Отправка)
|			ТОГДА ""send""
|		КОГДА Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.ОбработкаВходящего)
|			ТОГДА ""incoming""
|		ИНАЧЕ ""unknown""
|	КОНЕЦ,
|	ВЫБОР
|		КОГДА Статистика.Успешно
|			ТОГДА ""success""
|		ИНАЧЕ ""error""
|	КОНЕЦ";

Запрос.УстановитьПараметр("НачалоПериода", ТекущаяДатаСеанса() - 60);

Результат = Запрос.Выполнить();
Если НЕ Результат.Пустой() Тогда
	ТаблицаЗначений = Результат.Выгрузить();
КонецЕсли;
