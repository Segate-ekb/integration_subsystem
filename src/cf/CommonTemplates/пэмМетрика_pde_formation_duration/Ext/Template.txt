// Метрика: Время формирования сообщений (секунд)
// Лейблы: flow_name, aggregation (avg/max)
// Источник: РегистрСведений.инт_СтатистикаОбработкиСообщений

ТаблицаЗначений = Новый ТаблицаЗначений;
ТаблицаЗначений.Колонки.Добавить("flow_name", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("aggregation", Новый ОписаниеТипов("Строка"));
ТаблицаЗначений.Колонки.Добавить("value", Новый ОписаниеТипов("Число"));

Запрос = Новый Запрос;
Запрос.Текст =
"ВЫБРАТЬ
|	Статистика.ПотокДанных.Наименование КАК flow_name,
|	""avg"" КАК aggregation,
|	СРЕДНЕЕ(Статистика.ДлительностьМс) / 1000 КАК value
|ИЗ
|	РегистрСведений.инт_СтатистикаОбработкиСообщений КАК Статистика
|ГДЕ
|	Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.Формирование)
|	И Статистика.Период >= &НачалоПериода
|СГРУППИРОВАТЬ ПО
|	Статистика.ПотокДанных.Наименование
|
|ОБЪЕДИНИТЬ ВСЕ
|
|ВЫБРАТЬ
|	Статистика.ПотокДанных.Наименование,
|	""max"",
|	МАКСИМУМ(Статистика.ДлительностьМс) / 1000
|ИЗ
|	РегистрСведений.инт_СтатистикаОбработкиСообщений КАК Статистика
|ГДЕ
|	Статистика.ТипОперации = ЗНАЧЕНИЕ(Перечисление.инт_ТипыОперацийСтатистики.Формирование)
|	И Статистика.Период >= &НачалоПериода
|СГРУППИРОВАТЬ ПО
|	Статистика.ПотокДанных.Наименование";

Запрос.УстановитьПараметр("НачалоПериода", ТекущаяДатаСеанса() - 300); // Последние 5 минут

Результат = Запрос.Выполнить();
Если НЕ Результат.Пустой() Тогда
	ТаблицаЗначений = Результат.Выгрузить();
КонецЕсли;
