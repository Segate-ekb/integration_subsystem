///////////////////////////////////////////////////////////////////////////////
// инт_ПодписчикиJRPC (Модуль менеджера)
// Подписчики для отправки по JSON-RPC 2.0
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Формирует сообщение для отправки
//
// Параметры:
//  ДанныеСообщения - Соответствие - Данные для сериализации
//  Подписчик - СправочникСсылка.инт_ПодписчикиJRPC - Ссылка на подписчика
//  ИдентификаторСообщения - УникальныйИдентификатор - УИД сообщения
//
// Возвращаемое значение:
//  Строка - Сериализованное сообщение
//
Функция СформироватьСообщение(ДанныеСообщения, Подписчик, ИдентификаторСообщения) Экспорт
    
    // Формат JSON-RPC 2.0
    СообщениеJRPC = Новый Структура;
    СообщениеJRPC.Вставить("jsonrpc", "2.0");
    СообщениеJRPC.Вставить("method", "processMessage");
    СообщениеJRPC.Вставить("params", ДанныеСообщения);
    СообщениеJRPC.Вставить("id", Строка(ИдентификаторСообщения));
    
    Возврат инт_КоннекторHTTP.ОбъектВJson(СообщениеJRPC);
    
КонецФункции

// Отправляет сообщение подписчику
//
// Параметры:
//  Сообщение - Структура - Данные сообщения (ИдентификаторСообщения, Подписчик, СформированноеСообщение)
//  ОтложенныеДействия - Соответствие - Для пакетной обработки
//
Процедура ОтправитьСообщение(Сообщение, ОтложенныеДействия) Экспорт
    
    Подписчик = Сообщение.Подписчик;
    
    СтруктураПараметровСоединения = Справочники.инт_Эндпоинты.СтруктураПараметровСоединения(Подписчик.Эндпоинт);
    
    Заголовки = Новый Соответствие;
    Заголовки.Вставить("Content-Type", "application/json");
    
    Ответ = инт_КоннекторHTTP.Post(
        Подписчик.Эндпоинт.АдресРесурса, 
        Сообщение.СформированноеСообщение, 
        Заголовки, 
        СтруктураПараметровСоединения
    );
    
КонецПроцедуры

#КонецОбласти
