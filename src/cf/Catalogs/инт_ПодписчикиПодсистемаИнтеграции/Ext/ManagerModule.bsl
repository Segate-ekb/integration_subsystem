///////////////////////////////////////////////////////////////////////////////
// инт_ПодписчикиПодсистемаИнтеграции (Модуль менеджера)
// Подписчики для отправки в другую базу с подсистемой интеграции
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Формирует сообщение для отправки
//
// Параметры:
//  ДанныеСообщения - Соответствие - Данные для сериализации
//  Подписчик - СправочникСсылка.инт_ПодписчикиПодсистемаИнтеграции - Ссылка на подписчика
//  ИдентификаторСообщения - УникальныйИдентификатор - УИД сообщения
//
// Возвращаемое значение:
//  Строка - Сериализованное сообщение
//
Функция СформироватьСообщение(ДанныеСообщения, Подписчик, ИдентификаторСообщения) Экспорт
    
    Возврат инт_КоннекторHTTP.ОбъектВJson(ДанныеСообщения);
    
КонецФункции

// Отправляет сообщение подписчику
//
// Параметры:
//  Сообщение - Структура - Данные сообщения (ИдентификаторСообщения, Подписчик, СформированноеСообщение)
//  ОтложенныеДействия - Соответствие - Для пакетной обработки
//
Процедура ОтправитьСообщение(Сообщение, ОтложенныеДействия) Экспорт
    
    Подписчик = Сообщение.Подписчик;
    
    СтруктураПараметровСоединения = Справочники.инт_Эндпоинты.СтруктураПараметровСоединения(Подписчик.Эндпоинт);
    
    // URL по шаблону подсистемы интеграции
    URL = СтрШаблон("%1/hs/integration/v1/incoming/%2", 
        Подписчик.Эндпоинт.АдресРесурса,
        Подписчик.ИдентификаторПотокаПриёмника);
    
    Заголовки = Новый Соответствие;
    Заголовки.Вставить("X-Message-ID", Строка(Сообщение.ИдентификаторСообщения));
    
    инт_КоннекторHTTP.Post(URL, Сообщение.СформированноеСообщение, Заголовки, СтруктураПараметровСоединения);
    
КонецПроцедуры

#КонецОбласти
