////////////////////////////////////////////////////////////////////////////////
// Модуль: инт_ПреобразованиеДанных
//
// Описание:
//  Модуль для преобразования структурированных данных в дерево значений.
//  Используется для визуализации и отладки сложных структур данных (JSON-подобных объектов).
//
// Основные возможности:
//  - Преобразование соответствий и структур в дерево значений
//  - Обработка вложенных объектов любой глубины
//  - Обработка массивов с индексацией элементов
//  - Поддержка примитивных типов данных
//
// Использование:
//  Используется для представления JSON-данных в табличных частях
//  и деревьях значений для удобного просмотра в интерфейсе.
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Процедура - Значение в дерево
//
// Параметры:
//  Ключ            - Строка                        - Ключ для строки дерева значений
//  Значение        - Соответствие, Структура, Массив, Произвольный - Значение для строки дерева значений
//  КоллекцияСтрок  - КоллекцияСтрокДереваЗначений  - Строки дерева значений
//
// Описание:
//  Рекурсивно преобразует значение в строку дерева значений.
//  - Для объектов (Соответствие, Структура) - создает дочерние строки для каждого свойства
//  - Для массивов - создает дочерние строки для каждого элемента с индексом
//  - Для примитивных типов - записывает значение непосредственно в строку
//
Процедура ЗначениеВДерево(Ключ, Значение, КоллекцияСтрок) Экспорт
	
	Строка = КоллекцияСтрок.Добавить();
	Строка.Ключ = Ключ;
	Строка.ТипЗначения = ТипЗнч(Значение);
	
	Если ЭтоОбъект(Значение) Тогда
		ОбъектВДерево(Значение, Строка.Строки);
	ИначеЕсли ЭтоМассив(Значение) Тогда
		МассивВДерево(Значение, Строка.Строки);
	Иначе // Это примитив
		Строка.Значение = Значение;
	КонецЕсли;
		
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Процедура - Объект в дерево
//
// Параметры:
//  Объект          - Соответствие, Структура      - Объект для преобразования
//  КоллекцияСтрок  - КоллекцияСтрокДереваЗначений - Строки дерева значений
//
// Описание:
//  Преобразует объект (Соответствие или Структуру) в строки дерева значений,
//  создавая строку для каждого свойства объекта.
//
Процедура ОбъектВДерево(Объект, КоллекцияСтрок)
	
	Для Каждого ЭлементОбъекта Из Объект Цикл
		ЗначениеВДерево(ЭлементОбъекта.Ключ, ЭлементОбъекта.Значение, КоллекцияСтрок);
	КонецЦикла;
	
КонецПроцедуры

// Процедура - Массив в дерево
//
// Параметры:
//  Массив          - Массив                       - Массив для преобразования
//  КоллекцияСтрок  - КоллекцияСтрокДереваЗначений - Строки дерева значений
//
// Описание:
//  Преобразует массив в строки дерева значений, создавая строку для каждого элемента
//  с ключом вида "СтрокаМассива[индекс]".
//
Процедура МассивВДерево(Массив, КоллекцияСтрок)
	
	СчетчикСтрок = 0;
	Для Каждого ЭлементМассива Из Массив Цикл
		ЗначениеВДерево(СтрШаблон("СтрокаМассива[%1]", СчетчикСтрок), ЭлементМассива, КоллекцияСтрок);
		СчетчикСтрок = СчетчикСтрок + 1;
	КонецЦикла;
	
КонецПроцедуры

// Функция - Это объект
//
// Параметры:
//  Значение - Произвольный - Проверяемое значение
//
// Возвращаемое значение:
//  Булево - Истина, если значение является объектом (Соответствие или Структура)
//
Функция ЭтоОбъект(Значение)
	Возврат ТипЗнч(Значение) = Тип("Соответствие") ИЛИ ТипЗнч(Значение) = Тип("Структура");
КонецФункции

// Функция - Это массив
//
// Параметры:
//  Значение - Произвольный - Проверяемое значение
//
// Возвращаемое значение:
//  Булево - Истина, если значение является массивом
//
Функция ЭтоМассив(Значение)
	Возврат ТипЗнч(Значение) = Тип("Массив");
КонецФункции

#КонецОбласти
