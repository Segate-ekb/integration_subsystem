////////////////////////////////////////////////////////////////////////////////
// инт_ГенераторОбработокПовтИсп
//
// Кэширование значений модуля генерации обработок (EPF).
// Повторное использование возвращаемых значений: В течение сеанса.
//
// Структура дискового кэша:
//   {КаталогВременныхФайлов}/инт_epf_cache/
//     {GUID объекта}/           ← подпапка по потоку/подписчику
//       {хеш_текста_v1}.epf     ← версия обработчика
//       {хеш_текста_v2}.epf     ← новая версия после редактирования
//
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныйПрограммныйИнтерфейс

// Функция - Корневой каталог кэша EPF
// Возвращает путь к статичному каталогу файлового кэша EPF.
// Каталог создаётся при первом обращении и не меняется в течение сеанса.
//
// Возвращаемое значение:
//  Строка - Полный путь к корневому каталогу кэша (с разделителем на конце).
//
Функция КорневойКаталогКэша() Экспорт
	
	Каталог = КаталогВременныхФайлов() + "инт_epf_cache" + ПолучитьРазделительПути();
	
	КаталогФайл = Новый Файл(Каталог);
	Если Не КаталогФайл.Существует() Тогда
		СоздатьКаталог(Каталог);
	КонецЕсли;
	
	Возврат Каталог;
	
КонецФункции

// Функция - Путь EPF потока данных
// Возвращает путь к файлу EPF обработчика потока данных на диске.
// Если файл отсутствует — получает из БД или компилирует.
// Результат кэшируется в течение сеанса (ПовтИсп).
//
// Параметры:
//  ПотокДанных - СправочникСсылка.инт_ПотокиДанных - Ссылка на поток данных.
//
// Возвращаемое значение:
//  Строка - Полный путь к EPF-файлу обработчика. Пустая строка, если обработчик не задан.
//
Функция ПутьЕПФПотока(Знач ПотокДанных) Экспорт
	
	Если ПотокДанных.Пустая() Тогда
		Возврат "";
	КонецЕсли;
	
	ТекстОбработчика = ПотокДанных.ТекстОбработчика;
	Если Не ЗначениеЗаполнено(ТекстОбработчика) Тогда
		Возврат "";
	КонецЕсли;
	
	ИдОбъекта = Строка(ПотокДанных.УникальныйИдентификатор());
	ДвоичныеДанныеИзБД = ПотокДанных.СкомпилированныйОбработчик.Получить();
	
	Возврат инт_ГенераторОбработок.РазрешитьEPFПоКэшу(
		ТекстОбработчика, ИдОбъекта, ДвоичныеДанныеИзБД, , ПотокДанных);
	
КонецФункции

#КонецОбласти
