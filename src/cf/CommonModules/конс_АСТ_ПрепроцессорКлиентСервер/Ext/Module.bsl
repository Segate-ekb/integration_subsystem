// Препроцессор встроенного языка BSL (1C:Enterprise)
//
// Модуль реализует обработку директив препроцессора:
//   #Если / #ИначеЕсли / #Иначе / #КонецЕсли / #Область / #КонецОбласти
//
// Директивы управляют включением/исключением участков кода на основе
// переменных окружения (Сервер, Клиент, ТонкийКлиент и т.д.).
//
// Условия вычисляются через оператор Выполнить с подстановкой значений
// переменных окружения как параметров функции.
//
// Зависимости: нет (модуль полностью автономен)

#Область ПрограммныйИнтерфейс

Функция ПолучитьСтруктуруПеременныхПрепроцессора() Экспорт

	#Если Клиент Тогда
		конс_Клиент = Истина;
	#Иначе
		конс_Клиент = Ложь;
	#КонецЕсли

	#Если Сервер Тогда
		конс_Сервер = Истина;
	#Иначе
		конс_Сервер = Ложь;
	#КонецЕсли

	#Если ТонкийКлиент Тогда
		конс_ТонкийКлиент = Истина;
	#Иначе
		конс_ТонкийКлиент = Ложь;
	#КонецЕсли

	#Если МобильныйКлиент Тогда
		конс_МобильныйКлиент = Истина;
	#Иначе
		конс_МобильныйКлиент = Ложь;
	#КонецЕсли

	#Если ВебКлиент Тогда
		конс_ВебКлиент = Истина;
	#Иначе
		конс_ВебКлиент = Ложь;
	#КонецЕсли

	#Если ВнешнееСоединение Тогда
		конс_ВнешнееСоединение = Истина;
	#Иначе
		конс_ВнешнееСоединение = Ложь;
	#КонецЕсли

	#Если ТолстыйКлиентУправляемоеПриложение Тогда
		конс_ТолстыйКлиентУправляемоеПриложение = Истина;
	#Иначе
		конс_ТолстыйКлиентУправляемоеПриложение = Ложь;
	#КонецЕсли

	#Если ТолстыйКлиентОбычноеПриложение Тогда
		конс_ТолстыйКлиентОбычноеПриложение = Истина;
	#Иначе
		конс_ТолстыйКлиентОбычноеПриложение = Ложь;
	#КонецЕсли

	#Если МобильноеПриложениеКлиент Тогда
		конс_МобильноеПриложениеКлиент = Истина;
	#Иначе
		конс_МобильноеПриложениеКлиент = Ложь;
	#КонецЕсли

	#Если МобильноеПриложениеСервер Тогда
		конс_МобильноеПриложениеСервер = Истина;
	#Иначе
		конс_МобильноеПриложениеСервер = Ложь;
	#КонецЕсли

	#Если МобильныйАвтономныйСервер Тогда
		конс_МобильныйАвтономныйСервер = Истина;
	#Иначе
		конс_МобильныйАвтономныйСервер = Ложь;
	#КонецЕсли
	
	Результат = Новый Структура;
	
	Результат.Вставить("Клиент",                             конс_Клиент);
	Результат.Вставить("Сервер",                             конс_Сервер);
	Результат.Вставить("ТонкийКлиент",                       конс_ТонкийКлиент);
	Результат.Вставить("МобильныйКлиент",                    конс_МобильныйКлиент);
	Результат.Вставить("ВебКлиент",                          конс_ВебКлиент);
	Результат.Вставить("ВнешнееСоединение",                  конс_ВнешнееСоединение);
	Результат.Вставить("ТолстыйКлиентУправляемоеПриложение", конс_ТолстыйКлиентУправляемоеПриложение);
	Результат.Вставить("ТолстыйКлиентОбычноеПриложение",     конс_ТолстыйКлиентОбычноеПриложение);
	Результат.Вставить("МобильноеПриложениеКлиент",          конс_МобильноеПриложениеКлиент);
	Результат.Вставить("МобильноеПриложениеСервер",          конс_МобильноеПриложениеСервер);
	Результат.Вставить("МобильныйАвтономныйСервер",          конс_МобильныйАвтономныйСервер);
	
	Возврат Результат;
	
КонецФункции

// Обрабатывает директиву препроцессора: разбивает текст на слова и диспетчеризует
// обработку каждого слова в зависимости от текущего состояния стека директив.
//
// Параметры:
//  ТекущаяДиректива - Структура - лексема директивы (Значение, НомерСтроки, Позиция)
//  РежимЧтения - Булево - текущий режим включения кода (модифицируется)
//  СтекДирективПрепроцессора - Массив - стек состояний директив
//  ПеременныеПрепроцессора - Структура - переменные окружения (Сервер, Клиент и т.д.)
//  СписокОшибок - Массив - накопитель ошибок
//  ЕстьОшибка - Булево - флаг критической ошибки (модифицируется)
//  УсловияПрепроцессора - Соответствие - допустимые лексемы условий
Процедура ОбработатьДирективуПрепроцессора(ТекущаяДиректива, РежимЧтения, СтекДирективПрепроцессора, ПеременныеПрепроцессора, СписокОшибок, ЕстьОшибка, УсловияПрепроцессора) Экспорт
	Если ЕстьОшибка Тогда
		Возврат;
	КонецЕсли;
	СловаДирективы = РазобратьТекстДирективы(ТекущаяДиректива.Значение);
	ТекстУсловия = "";
	Для Каждого СловоДирективы Из СловаДирективы Цикл
		Если ЭтоДирективаОбласти(СловоДирективы) Тогда
			Возврат;
		КонецЕсли;
		ПроверитьМногословнуюДирективу(СловаДирективы, СловоДирективы, ТекущаяДиректива, СписокОшибок, ЕстьОшибка);
		СостояниеСтека = ОпределитьСостояниеСтекаДиректив(СтекДирективПрепроцессора);
		Если СостояниеСтека = "ПустойСтек" Тогда
			ОбработатьДирективуПриПустомСтеке(СловоДирективы, СтекДирективПрепроцессора, ТекущаяДиректива, СписокОшибок, ЕстьОшибка);
		ИначеЕсли СостояниеСтека = "ОПЕРАТОР" Тогда
			ОбработатьДирективуСостояниеОператор(СловоДирективы, СтекДирективПрепроцессора, РежимЧтения, ТекущаяДиректива, СписокОшибок, ЕстьОшибка);
		ИначеЕсли СостояниеСтека = "ЕСЛИ" Тогда
			ОбработатьДирективуСостояниеЕсли(СловоДирективы, СтекДирективПрепроцессора, ТекстУсловия, РежимЧтения, ПеременныеПрепроцессора, ТекущаяДиректива, СписокОшибок, ЕстьОшибка, УсловияПрепроцессора);
		ИначеЕсли СостояниеСтека = "УСЛОВИЕ" Тогда
			ОбработатьДирективуСостояниеУсловие(СловоДирективы, СтекДирективПрепроцессора, РежимЧтения, ТекущаяДиректива, СписокОшибок, ЕстьОшибка);
		ИначеЕсли СостояниеСтека = "ИНАЧЕ" Тогда
			ОбработатьДирективуСостояниеИначе(СловоДирективы, СтекДирективПрепроцессора, РежимЧтения, ТекущаяДиректива, СписокОшибок, ЕстьОшибка);
		КонецЕсли;
		Если ЕстьОшибка Тогда
			Возврат;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

// Формирует структуру ошибки для некорректного синтаксиса препроцессора.
//
// Параметры:
//  СписокОшибок - Массив - накопитель ошибок
//  Директива - Структура - лексема директивы (НомерСтроки, Позиция)
//  ФлагОшибки - Булево - флаг наличия критической ошибки (модифицируется)
Процедура ДобавитьОшибкуДирективы(СписокОшибок, Директива, ФлагОшибки) Экспорт
	СтруктураОшибки = Новый Структура("Тип,Название,Строка", 0, НСтр("ru = 'Некорректный синтаксис препроцессора ('; en = 'Incorrect preprocessor syntax ('", ТекущийЯзыкСистемы()) + Директива.НомерСтроки + ", " + Директива.Позиция + ")", Директива.НомерСтроки);
	СписокОшибок.Добавить(СтруктураОшибки);
	ФлагОшибки = Истина;
КонецПроцедуры

#КонецОбласти // ПрограммныйИнтерфейс

#Область СлужебныеПроцедурыИФункции

// Проверяет, является ли слово директивой области (ОБЛАСТЬ/КОНЕЦОБЛАСТИ/REGION/ENDREGION).
Функция ЭтоДирективаОбласти(СловоДирективы)
	Возврат СловоДирективы = "ОБЛАСТЬ" ИЛИ СловоДирективы = "КОНЕЦОБЛАСТИ"
		ИЛИ СловоДирективы = "REGION" ИЛИ СловоДирективы = "ENDREGION";
КонецФункции
// Проверяет допустимость одиночного слова-директивы в многословной директиве.
// ИНАЧЕ/ELSE/КОНЕЦЕСЛИ/ENDIF не могут использоваться в составных директивах.
Процедура ПроверитьМногословнуюДирективу(СловаДирективы, СловоДирективы, ТекущаяДиректива, СписокОшибок, ЕстьОшибка)
	Если СловаДирективы.Количество() <= 1 Тогда
		Возврат;
	КонецЕсли;
	Если СловоДирективы = "ИНАЧЕ" ИЛИ СловоДирективы = "ELSE"
		ИЛИ СловоДирективы = "КОНЕЦЕСЛИ" ИЛИ СловоДирективы = "ENDIF" Тогда
		ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
	КонецЕсли;
КонецПроцедуры
// Определяет текущее состояние стека директив препроцессора для диспетчеризации обработки.
//
// Возвращаемое значение:
//  Строка - "ПустойСтек", "ОПЕРАТОР", "ЕСЛИ", "УСЛОВИЕ", "ИНАЧЕ" или "НЕИЗВЕСТНО"
Функция ОпределитьСостояниеСтекаДиректив(СтекДирективПрепроцессора)
	Если СтекДирективПрепроцессора.Количество() = 0 Тогда
		Возврат "ПустойСтек";
	КонецЕсли;
	ИмяЭлемента = СтекДирективПрепроцессора[0].Имя;
	Если ИмяЭлемента = "ОПЕРАТОР" Тогда
		Возврат "ОПЕРАТОР";
	ИначеЕсли ИмяЭлемента = "ЕСЛИ" ИЛИ ИмяЭлемента = "IF" ИЛИ ИмяЭлемента = "ИНАЧЕЕСЛИ" ИЛИ ИмяЭлемента = "ELSIF" Тогда
		Возврат "ЕСЛИ";
	ИначеЕсли ИмяЭлемента = "УСЛОВИЕ" ИЛИ ИмяЭлемента = "ПОСТ_УСЛОВИЕ" Тогда
		Возврат "УСЛОВИЕ";
	ИначеЕсли ИмяЭлемента = "ИНАЧЕ" ИЛИ ИмяЭлемента = "ELSE" Тогда
		Возврат "ИНАЧЕ";
	Иначе
		Возврат "НЕИЗВЕСТНО";
	КонецЕсли;
КонецФункции
// Обрабатывает слово директивы при пустом стеке.
// В этом состоянии допускается только начало нового условия (ЕСЛИ/IF).
Процедура ОбработатьДирективуПриПустомСтеке(СловоДирективы, СтекДирективПрепроцессора, ТекущаяДиректива, СписокОшибок, ЕстьОшибка)
	Если СловоДирективы = "ЕСЛИ" ИЛИ СловоДирективы = "IF" Тогда
		СтекДирективПрепроцессора.Вставить(0, Новый Структура("Имя,Директива", СловоДирективы, ТекущаяДиректива));
	Иначе
		ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
	КонецЕсли;
КонецПроцедуры
// Обрабатывает слово директивы в состоянии «ОПЕРАТОР» (между КонецЕсли и следующим Если).
Процедура ОбработатьДирективуСостояниеОператор(СловоДирективы, СтекДирективПрепроцессора, РежимЧтения, ТекущаяДиректива, СписокОшибок, ЕстьОшибка)
	Если СловоДирективы = "ЕСЛИ" ИЛИ СловоДирективы = "ИНАЧЕЕСЛИ" ИЛИ СловоДирективы = "IF" ИЛИ СловоДирективы = "ELSIF" Тогда
		СтекДирективПрепроцессора.Вставить(0, Новый Структура("Имя,Директива", СловоДирективы, ТекущаяДиректива));
	ИначеЕсли СловоДирективы = "КОНЕЦЕСЛИ" ИЛИ СловоДирективы = "ENDIF" Тогда
		ОбработатьКонецЕсли(СтекДирективПрепроцессора, СписокОшибок, ТекущаяДиректива, ЕстьОшибка, РежимЧтения);
	ИначеЕсли СловоДирективы = "ИНАЧЕ" ИЛИ СловоДирективы = "ELSE" Тогда
		РезультатАнализа = АнализироватьСтекДиректив(СтекДирективПрепроцессора);
		РежимЧтения = ?(НЕ РезультатАнализа.НайденоДействующееУсловие И РезультатАнализа.РежимЧтения, Истина, Ложь);
		СтекДирективПрепроцессора.Вставить(0, Новый Структура("Имя,Директива", СловоДирективы, ТекущаяДиректива));
	Иначе
		ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
	КонецЕсли;
КонецПроцедуры
// Обрабатывает слово директивы в состоянии «ЕСЛИ»/«ИНАЧЕЕСЛИ» — ожидание условия и ТОГДА.
Процедура ОбработатьДирективуСостояниеЕсли(СловоДирективы, СтекДирективПрепроцессора, ТекстУсловия, РежимЧтения, ПеременныеПрепроцессора, ТекущаяДиректива, СписокОшибок, ЕстьОшибка, УсловияПрепроцессора)
	ТекущийЭлементСтека = СтекДирективПрепроцессора[0];
	Если СловоДирективы = "ТОГДА" ИЛИ СловоДирективы = "THEN" Тогда
		Если ЗначениеЗаполнено(ТекстУсловия) Тогда
			ОбработатьУсловиеТогда(СтекДирективПрепроцессора, ТекстУсловия, РежимЧтения, ПеременныеПрепроцессора, ТекущийЭлементСтека, ТекущаяДиректива, СписокОшибок, ЕстьОшибка);
			ТекстУсловия = "";
		Иначе
			ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
		КонецЕсли;
	Иначе
		Если УсловияПрепроцессора[СловоДирективы] <> Неопределено Тогда
			ТекстУсловия = ТекстУсловия + " " + СловоДирективы;
		Иначе
			ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры
// Обрабатывает вычисление условия при достижении ключевого слова ТОГДА/THEN.
// Вычисляет условие, определяет его тип (первичное или последующее), обновляет режим чтения.
Процедура ОбработатьУсловиеТогда(СтекДирективПрепроцессора, ТекстУсловия, РежимЧтения, ПеременныеПрепроцессора, ТекущийЭлементСтека, ТекущаяДиректива, СписокОшибок, ЕстьОшибка)
	СтекДирективПрепроцессора.Удалить(0);
	РезультатУсловия = ВычислитьУсловиеПрепроцессора(ТекстУсловия, ПеременныеПрепроцессора, ЕстьОшибка, СписокОшибок, ТекущаяДиректива);
	ЭлементСтекаУсловия = Новый Структура("Директива,Результат", ТекущаяДиректива, РезультатУсловия);
	Если ЕстьОшибка Тогда
		Возврат;
	КонецЕсли;
	Если ТекущийЭлементСтека.Имя = "ИНАЧЕЕСЛИ" ИЛИ ТекущийЭлементСтека.Имя = "ELSIF" Тогда
		РезультатАнализа = АнализироватьСтекДиректив(СтекДирективПрепроцессора);
		РежимЧтения = ?(НЕ РезультатАнализа.НайденоДействующееУсловие И РезультатАнализа.РежимЧтения, РезультатУсловия, Ложь);
		ЭлементСтекаУсловия.Вставить("Имя", "ПОСТ_УСЛОВИЕ");
	Иначе
		ЭлементСтекаУсловия.Вставить("РежимЧтения", РежимЧтения);
		РежимЧтения = ?(РежимЧтения = Ложь, Ложь, РезультатУсловия);
		ЭлементСтекаУсловия.Вставить("Имя", "УСЛОВИЕ");
	КонецЕсли;
	СтекДирективПрепроцессора.Вставить(0, ЭлементСтекаУсловия);
КонецПроцедуры
// Проверяет, является ли слово директивой ветвления (ЕСЛИ/ИНАЧЕЕСЛИ/ИНАЧЕ и EN-эквиваленты).
Функция ЭтоДирективаВетвления(СловоДирективы)
	Возврат СловоДирективы = "ИНАЧЕЕСЛИ" ИЛИ СловоДирективы = "ELSIF"
		ИЛИ СловоДирективы = "ИНАЧЕ" ИЛИ СловоДирективы = "ELSE"
		ИЛИ СловоДирективы = "ЕСЛИ" ИЛИ СловоДирективы = "IF";
КонецФункции
// Обрабатывает слово директивы в состоянии «УСЛОВИЕ»/«ПОСТ_УСЛОВИЕ» (после вычисления условия).
Процедура ОбработатьДирективуСостояниеУсловие(СловоДирективы, СтекДирективПрепроцессора, РежимЧтения, ТекущаяДиректива, СписокОшибок, ЕстьОшибка)
	Если ЭтоДирективаВетвления(СловоДирективы) Тогда
		Если СловоДирективы = "ИНАЧЕ" ИЛИ СловоДирективы = "ELSE" Тогда
			РезультатАнализа = АнализироватьСтекДиректив(СтекДирективПрепроцессора);
			РежимЧтения = ?(НЕ РезультатАнализа.НайденоДействующееУсловие И РезультатАнализа.РежимЧтения, Истина, Ложь);
		КонецЕсли;
		СтекДирективПрепроцессора.Вставить(0, Новый Структура("Имя,Директива", СловоДирективы, ТекущаяДиректива));
	ИначеЕсли СловоДирективы = "КОНЕЦЕСЛИ" ИЛИ СловоДирективы = "ENDIF" Тогда
		ОбработатьКонецЕсли(СтекДирективПрепроцессора, СписокОшибок, ТекущаяДиректива, ЕстьОшибка, РежимЧтения);
	Иначе
		ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
	КонецЕсли;
КонецПроцедуры
// Обрабатывает слово директивы в состоянии «ИНАЧЕ»/«ELSE» (ветка Иначе).
Процедура ОбработатьДирективуСостояниеИначе(СловоДирективы, СтекДирективПрепроцессора, РежимЧтения, ТекущаяДиректива, СписокОшибок, ЕстьОшибка)
	Если СловоДирективы = "ЕСЛИ" ИЛИ СловоДирективы = "IF" Тогда
		СтекДирективПрепроцессора.Вставить(0, Новый Структура("Имя,Директива", СловоДирективы, ТекущаяДиректива));
	ИначеЕсли СловоДирективы = "КОНЕЦЕСЛИ" ИЛИ СловоДирективы = "ENDIF" Тогда
		ОбработатьКонецЕсли(СтекДирективПрепроцессора, СписокОшибок, ТекущаяДиректива, ЕстьОшибка, РежимЧтения);
	Иначе
		ДобавитьОшибкуДирективы(СписокОшибок, ТекущаяДиректива, ЕстьОшибка);
	КонецЕсли;
КонецПроцедуры
// Вычисляет условие директивы препроцессора, подставляя значения переменных окружения.
//
// Параметры:
//  ТекстУсловия - Строка - текст условия (например "Сервер И НЕ Клиент")
//  ПеременныеПП - Структура - переменные препроцессора (Сервер, Клиент, ТонкийКлиент, ...)
//  ФлагОшибки - Булево - признак критической ошибки (модифицируется при ошибке)
//  СписокОшибок - Массив - массив ошибок компиляции
//  Директива - Структура - текущая директива (для позиционирования ошибки)
//
// Возвращаемое значение:
//  Булево - результат вычисления условия
Функция ВычислитьУсловиеПрепроцессора(ТекстУсловия, ПеременныеПрепроцессора, ФлагОшибки, СписокОшибок, Директива)
	Попытка
		Переменные = ПеременныеПрепроцессора;
		Результат = ВыполнитьВычислениеУсловияПрепроцессора(ТекстУсловия,
			Переменные.Сервер, Переменные.Клиент, Переменные.Сервер, Переменные.Клиент,
			Переменные.ТонкийКлиент, Переменные.МобильныйКлиент, Переменные.ВебКлиент, Переменные.ВнешнееСоединение,
			Переменные.ТолстыйКлиентУправляемоеПриложение, Переменные.ТолстыйКлиентОбычноеПриложение,
			Переменные.МобильноеПриложениеКлиент, Переменные.МобильноеПриложениеСервер, Переменные.МобильныйАвтономныйСервер,
			Переменные.Сервер, Переменные.Клиент, Переменные.Сервер, Переменные.Клиент,
			Переменные.ТонкийКлиент, Переменные.МобильныйКлиент, Переменные.ВебКлиент, Переменные.ВнешнееСоединение,
			Переменные.ТолстыйКлиентУправляемоеПриложение, Переменные.ТолстыйКлиентОбычноеПриложение,
			Переменные.МобильноеПриложениеКлиент, Переменные.МобильноеПриложениеСервер, Переменные.МобильныйАвтономныйСервер);
		Возврат Результат;
	Исключение
		ДобавитьОшибкуДирективы(СписокОшибок, Директива, ФлагОшибки);
	КонецПопытки;
КонецФункции
// Вычисляет условие препроцессора через Выполнить, подставляя значения переменных окружения.
// Параметры содержат RU- и EN-именованные переменные препроцессора для подстановки в Выполнить.
Функция ВыполнитьВычислениеУсловияПрепроцессора(ТекстУсловия, Сервер, Клиент, НаСервере, НаКлиенте, ТонкийКлиент, МобильныйКлиент, ВебКлиент, ВнешнееСоединение, ТолстыйКлиентУправляемоеПриложение, ТолстыйКлиентОбычноеПриложение, МобильноеПриложениеКлиент, МобильноеПриложениеСервер, МобильныйАвтономныйСервер, Server, Client, AtServer, AtClient, ThinClient, MobileClient, WebClient, ExternalConnection, ThickClientManagedApplication, ThickClientOrdinaryApplication, MobileAppClient, MobileAppServer, MobileStandaloneServer)
	РезультатУсловия = Неопределено;
	Выполнить "РезультатУсловия = " + ТекстУсловия;
	Возврат РезультатУсловия;
КонецФункции
Процедура ОбработатьКонецЕсли(СтекДирективПП, СписокОшибок, Директива, ФлагОшибки, РежимЧтения)
	Пока СтекДирективПП.Количество() > 0 Цикл
		Если СтекДирективПП[0].Имя = "ОПЕРАТОР" ИЛИ СтекДирективПП[0].Имя = "ИНАЧЕ" ИЛИ СтекДирективПП[0].Имя = "ELSE" ИЛИ СтекДирективПП[0].Имя = "ПОСТ_УСЛОВИЕ" Тогда
			СтекДирективПП.Удалить(0);
		ИначеЕсли СтекДирективПП[0].Имя = "УСЛОВИЕ" Тогда
			РежимЧтения = СтекДирективПП[0].РежимЧтения;
			СтекДирективПП.Удалить(0);
			СтекДирективПП.Вставить(0, Новый Структура("Имя", "ОПЕРАТОР"));
			Возврат;
		Иначе
			ДобавитьОшибкуДирективы(СписокОшибок, Директива, ФлагОшибки);
			Возврат;
		КонецЕсли;
	КонецЦикла;
	ДобавитьОшибкуДирективы(СписокОшибок, Директива, ФлагОшибки);
КонецПроцедуры
Функция АнализироватьСтекДиректив(СтекДиректив)
	Результат = Новый Структура("НайденоДействующееУсловие", Ложь);
	Индекс = 0;
	Пока Индекс < СтекДиректив.Количество() Цикл
		Если СтекДиректив[Индекс].Имя = "УСЛОВИЕ" Тогда
			Результат.Вставить("РежимЧтения", СтекДиректив[Индекс].РежимЧтения);
			Если СтекДиректив[Индекс].Результат = Истина Тогда
				Результат.НайденоДействующееУсловие = Истина;
			КонецЕсли;
			Прервать;
		ИначеЕсли СтекДиректив[Индекс].Имя = "ПОСТ_УСЛОВИЕ" Тогда
			Если СтекДиректив[Индекс].Результат = Истина Тогда
				Результат.НайденоДействующееУсловие = Истина;
			КонецЕсли;
		КонецЕсли;
		Индекс = Индекс + 1;
	КонецЦикла;
	Возврат Результат;
КонецФункции
Функция РазобратьТекстДирективы(Знач ТекстДирективы)
	МассивСлов = Новый Массив;
	Позиция = 1;
	ТекущееСлово = "";
	ТекстДирективы = Сред(СокрЛП(ТекстДирективы), 2);
	Пока Позиция <= СтрДлина(ТекстДирективы) Цикл
		ТекущийСимвол = Сред(ТекстДирективы, Позиция, 1);
		Если ТекущийСимвол = " " Тогда
			Если ЗначениеЗаполнено(ТекущееСлово) Тогда
				МассивСлов.Добавить(ВРег(ТекущееСлово));
				ТекущееСлово = "";
			КонецЕсли;
		ИначеЕсли ТекущийСимвол = "(" ИЛИ ТекущийСимвол = ")" Тогда
			Если ЗначениеЗаполнено(ТекущееСлово) Тогда
				МассивСлов.Добавить(ВРег(ТекущееСлово));
				ТекущееСлово = "";
			КонецЕсли;
			МассивСлов.Добавить(ТекущийСимвол);
		Иначе
			ТекущееСлово = ТекущееСлово + ТекущийСимвол;
		КонецЕсли;
		Позиция = Позиция + 1;
	КонецЦикла;
	Если ЗначениеЗаполнено(ТекущееСлово) Тогда
		МассивСлов.Добавить(ВРег(ТекущееСлово));
	КонецЕсли;
	Возврат МассивСлов;
КонецФункции

#КонецОбласти // СлужебныеПроцедурыИФункции
