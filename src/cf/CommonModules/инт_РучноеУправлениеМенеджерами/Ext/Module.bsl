////////////////////////////////////////////////////////////////////////////////
// Общий модуль инт_РучноеУправлениеМенеджерами
// Содержит процедуры для управляющих фоновых заданий менеджеров потоков
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Управляющее фоновое задание для менеджера формирования сообщений.
// Раз в 3 секунды запускает менеджер потоков формирования.
// 
Процедура УправляющееЗаданиеФормирования() Экспорт
	
	ИнтервалПроверкиСек = 3;
	
	ЗаписьЖурналаРегистрации(
		"ПодсистемаИнтеграции.РучноеУправление",
		УровеньЖурналаРегистрации.Информация,
		,
		,
		"Управляющее ФЗ формирования: Начало работы");
	
	Пока Истина Цикл
		
		Попытка
			инт_ФормированиеИсходящихСообщений.ЗапускМенеджераПотоков();
		Исключение
			ЗаписьЖурналаРегистрации(
				"ПодсистемаИнтеграции.РучноеУправление",
				УровеньЖурналаРегистрации.Ошибка,
				,
				,
				"Ошибка в управляющем ФЗ формирования: " + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		// Пауза перед следующей итерацией (пэмМетрикиСервер.Пауза принимает секунды)
		пэмМетрикиСервер.Пауза(ИнтервалПроверкиСек);      
		
		
	КонецЦикла;
	
КонецПроцедуры

// Управляющее фоновое задание для менеджера отправки сообщений.
// Раз в 3 секунды запускает менеджер потоков отправки.
// 
Процедура УправляющееЗаданиеОтправки() Экспорт
	
	ИнтервалПроверкиСек = 3;
	
	ЗаписьЖурналаРегистрации(
		"ПодсистемаИнтеграции.РучноеУправление",
		УровеньЖурналаРегистрации.Информация,
		,
		,
		"Управляющее ФЗ отправки: Начало работы");
	
	Пока Истина Цикл
		
		Попытка
			инт_ОтправкаИсходящихСообщений.инт_ЗапуститьМенеджерПотоковРассылкиСообщений();
		Исключение
			ЗаписьЖурналаРегистрации(
				"ПодсистемаИнтеграции.РучноеУправление",
				УровеньЖурналаРегистрации.Ошибка,
				,
				,
				"Ошибка в управляющем ФЗ отправки: " + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		// Пауза перед следующей итерацией (пэмМетрикиСервер.Пауза принимает секунды)
		пэмМетрикиСервер.Пауза(ИнтервалПроверкиСек);
		
	КонецЦикла;
	
КонецПроцедуры

// Управляющее фоновое задание для менеджера входящих потоков.
// Раз в 3 секунды запускает консьюмеры асинхронных подписок.
// 
Процедура УправляющееЗаданиеВходящих() Экспорт
	
	ИнтервалПроверкиСек = 3;
	
	ЗаписьЖурналаРегистрации(
		"ПодсистемаИнтеграции.РучноеУправление",
		УровеньЖурналаРегистрации.Информация,
		,
		,
		"Управляющее ФЗ входящих: Начало работы");
	
	Пока Истина Цикл
		
		Попытка
			инт_МенеджерВходящихПотоков.ЗапуститьКонсьюмерыАсинхронныхПодписок();
		Исключение
			ЗаписьЖурналаРегистрации(
				"ПодсистемаИнтеграции.РучноеУправление",
				УровеньЖурналаРегистрации.Ошибка,
				,
				,
				"Ошибка в управляющем ФЗ входящих: " + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		// Пауза перед следующей итерацией
		пэмМетрикиСервер.Пауза(ИнтервалПроверкиСек);
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти
